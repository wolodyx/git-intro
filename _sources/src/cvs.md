# Система контроля версий


## Введение


## Совместная работа над документом

<!-- Работа с постоянно изменяющимися электронным документом -->
Классический пример совместной работы над документом -- это подготовка отчета, диплома, статьи, учебного пособия.
Начальную версию документа автор пишет самостоятельно или компонует из частей, написанных им и соавторами.
Затем он получает обратную связь у заинтересованных сторон: соавторов, коллег, руководителей, рецензентов и редакторов.
Автор обновляет свою версию документа, объединяя в нем полученные замечания и правки.
Это повторяется до тех пор, пока все участники не достигнут компромисса.
Основная тяжесть по сопровождению документа ложится на автора.
Он должен сохранить логическую целостность документа и не потерять удачные куски текста.

Следует выделить следующие недостатки совместной работы над документом:
* не видны правки;
* теряются предыдущие версии документа;
* теряется информация о том, кто, когда, что и зачем изменил;
* последовательность процесса редактирования.

<!-- Недостаток: не видны правки -->
В объемном документе сложно, если вообще можно увидеть чужие правки.
Их следует найти, сравнивая в двух документах предложение за предложением.
Это очень утомительно.
Для решения этой проблемы, редактор текстовых документов "Microsoft Word" предлагает режим правок, при включении которого последующие редактирование текста выделяются визуально, сохраняя исходное значение.
Уже автор работает с правками, применяя или отказываясь от них.

Часто бывает, что рецензенты не редактируют присланный им документ, а делают замечания, привязывая их к номеру страницы и абзаца.
Таким образом, автор сам вносит изменения по полученным замечаниям.

<!-- Недостаток: теряются предыдущие версии документа -->
После внесения правок предыдущая версия текста замещается новой.
Все текстовые редакторы поддерживают команду отката изменений, которая позволяет вернуть назад старую версию.
Команда применима только к тем правкам, которые были сделаны с момента последнего запуска программы.
<!-- Резервное копирование файлов -->
Чтобы сохранить старые версии электронных документов, делают их резервные копии.
В случае потери данных, например, из-за поломки диска, удаления или случайной перезаписи данных, данные восстанавливаются по последней копии.
При этом потеряются изменения, которые были произведены с момента последней резервной копии, что лучше, чем потерять все.
Резервное копирование часто применяют при подготовке офисных документов, когда следующая версия документа именуется в стиле "ОтчетНИР_15_Иванов.docx", где в названии прописаны версия документа и автор правки.
Такой подход хоть и страхует от потери документа, но требует строгого соблюдения правил.

<!-- Недостаток: кто, когда, что и зачем предложил изменения -->
Следующий недостаток при совместной работе над документом состоит в том, что автору не доступна информация о том, кто, когда, что и зачем предложил изменения.
Для небольших по объему документов с единственным владельцем, это не так актуально, так как информация сохраняется в электронной переписке, в резервных копиях файлов или в голове автора, работавшего с документом.
Но если файлами владеет коллектив, то история изменений позволяет войти в курс дела новичкам.

<!-- Недостаток: последовательная работа -->
Слабое место при совместной работе над документом -- это объединение правок от нескольких участников, которым приходится заниматься автору.
Этот процесс утомителен и подвержен ошибкам.
Чтобы обойти это, над документом работают последовательно.
Каждый следующий участник работает над документом после предыдущего.
Это растягивает время работы и слабо загружает участников.
Это одна из причин, почему оформление научной статьи занимает год и более.


## Общая концепция СКВ

<!-- Что такое СКВ -->
Недостатки совместной работы над файлом, не являются критичными применительно к офисным документам, но они неприемлемы при разработке программного обеспечения.
<!-- Разработка ПО как постоянное внесение изменений в исходные коды -->
Программа, удовлетворяющая техническому заданию, возникает не одномоментно, а представляет итерационный процесс.
Этот процесс контролируют разработчики и наблюдают тестировщики и пользователи.

В этом процессе параллельно работают группа людей, которые постоянно изменяют исходные коды.
Разработчики программ, столкнувшись с этой проблемой, создали специальную программу -- систему контроля версий (СКВ), которая решает недостатки, перечисленные выше.
Она:
* показывает правки, внесенные в файлы;
* сохраняет каждую версию файла;
* связывает с правками информация о том, кто, когда, что и зачем изменил;
* обеспечивает параллельную работу над проектом.

<!-- Хранилище, рабочая копия и каталог проекта -->
Контроль версий применяется к файлам, сгруппированным в одном каталоге, называемом *рабочим каталогом*.
Все изменения файлов хранятся в базе данных, называемой *хранилищем*, которое также известно под термином *репозиторий*.
Из хранилища можно восстановить состояние файлов на любой момент времени.
Эту операцию называют *извлечением файлов*.
Извлеченные файлы помещаются в рабочий каталог и называют *рабочей копией*.
Чаще всего интерес представляет рабочая копия последней версии файлов.

<!-- Фиксация изменений в хранилище -->
В ходе работы разработчик редактирует файлы из рабочей копии проекта.
Когда работа близится к логическому завершению, изменения заносятся в хранилище, т.е. *фиксируются* в системе.
После фиксации в хранилище появляется запись, называемое *коммитом*.
Коммит -- это зафиксированный набор изменений.
Действие по фиксации еще называют *сделать коммит*, *закоммитить*, *зафиксировать изменения* или *внести изменения*.
Получившаяся после коммита версия проекта называется *ревизией*.


## История развития СКВ

<!-- Локальная СКВ -->
Самая первая СКВ [RCS](https://www.gnu.org/software/rcs/rcs.html) появилась в 1982 году.
Она доступна до сих пор и поддерживается в рамках проекта GNU.

``` bash
skt@home:~$ rcs --commands
(command)   (description)
 ci          Check in revisions of RCS files from working files.
 co          Check out working files from revisions of RCS files.
 frob        Change RCS file attributes.
 clean       Clean up working files.
 diff        Compare RCS revisions.
 merge       Merge RCS revisions.
 log         Print log messages and other information about RCS files.
```

Термин "локальная" означает, что система предназначена для частного применения, так как работает на одной машине и не обладает инструментами коллективной работы над проектом.

<!-- Централизованная СКВ -->
Развитием локальных систем стали *централизованные*, где хранилище вынесено на удаленный сервер, а клиенты загружают по сети рабочую копию.
Централизованный доступ к хранилище с доступом к нему клиентов.

<!--
Доступ к хранилищу предоставляется группе людей.
Контроль прав доступа к частям хранилища.
Блокировка файлов -- временное ограничение доступа, изменения файла, до тех пор пока другой разработчик не внесет в него изменений.
Недостатки децентрализованных СКВ:
* привязка рабочего места к серверу;
* сетевые накладные расходы при выполнении команд;
* риск потери хранилища.
-->
Примеры таких систем -- это `CVS` и `Subversion`.

<!-- Децентрализованная СКВ -->
Развитием централизованных систем стали *децентрализованные*, в которых каждый клиент обладает своей копией хранилища.
Это решает недостатки централизованных систем.
Разработчик не привязан к серверу и может продолжить свою работу и без доступа к сети.
Так как хранилище располагается на машине разработчика, то все команды выполняются быстро.
<!-- Понятие ветки -->
По сравнению с централизованными системами, децентрализованные обладают развитыми инструментами для обмена изменениями и объединения результатов.

Примеры таких систем -- это Git и Mercurial.
Из всех систем наибольшую популярность получила Git.
Mercurial еще используется в некоторых коллективах.
Она проще в обучении и имеет удобный графический интерфейс TortoiseHg в среде Windows.
Но постепенно происходит переход на Git, что связано с полуярностью хостинга [GitHub](https://github.com).
А сложность Git (по сравнению с Mercurial) не отталкивает разработчиков, а наоборот, дает гибкости в нестандартных ситуациях.

<!--
История изменений, история коммитов.
-->


## Сценарий работы с Git


## Контрольные вопросы

1. Для каких целей изменяют программу?
1. Почему не получается воспользоваться СКВ применительно к офисным документам?
1. Что такое коммит?
1. В чем отличие ревизии от коммита?


## Упражнения

1.

